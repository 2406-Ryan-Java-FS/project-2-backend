#Copies the compiled jar into the docker image we're creating

#docker build -t image1 .

from eclipse-temurin:17-jdk as build
workdir /theApp
copy ./target/RevLearn-0.0.1-SNAPSHOT.jar ./RevLearn-0.0.1-SNAPSHOT.jar

copy ./application-awstest.properties ./application-awstest.properties

#Could not get environment variables working. Using secret spring profiles instead.
# arg RAND
# run echo "RAND=${RAND}"
# env JWT_SECRET=${RAND}
# run echo "JWT_SECRET=${JWT_SECRET}"

expose 8080
entrypoint ["java","-jar",\
    "RevLearn-0.0.1-SNAPSHOT.jar",\
    "--spring.profiles.active=awstest",\
    "--spring.config.location=file:/theApp/application-awstest.properties"]

#from oracle/graalvm-ce:21.3.0-java17
# from eclipse-temurin:17-jdk
# workdir /theApp
#
# #ERROR: failed to solve: failed to compute cache key:
# #failed to calculate checksum of ref 3633481f-e69d-439a-a183-d8a6bb9179f4::9od0mzmyu8sa4f3icbnqbrhvi:
# #"/target/RevLearn-0.0.1-SNAPSHOT.jar": not found
# run ls
# copy --from=build ./target/RevLearn-0.0.1-SNAPSHOT.jar ./RevLearn-0.0.1-SNAPSHOT.jar
# expose 8080
# entrypoint ["java","-jar","RevLearn-0.0.1-SNAPSHOT.jar"]